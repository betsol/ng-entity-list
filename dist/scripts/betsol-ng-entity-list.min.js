/**
 * betsol-ng-entity-list - Automatic entity lists for Angular.js
 * @version v0.0.1
 * @link https://github.com/betsol/ng-entity-list
 * @license MIT
 *
 * @author Slava Fomin II <s.fomin@betsol.ru>
 */
!function(e,t,n){"use strict";function r(e){return e=t.extend({},o,e),t.forEach(e.fields,function(n,r){e.fields[r]=t.extend({},a,n)}),e}function i(){var e={};return e.default=function(e){return e},e.date=function(e,t){return n&&n.isMoment(e)?e.format(t.format||"D.M.YY HH:mm:ss"):e instanceof Date?e.toString():void 0},e}var o={title:"",fields:{},add:!0,edit:!0,"delete":!0},a={title:"",type:"string"},s=50;t.module("betsol.entityList",["ui.router","betsol.paginator"]).factory("EntityList",["Paginator",function(n){return function(o){var a={scope:null,baseStateName:"",repository:null,scheme:null,itemsPerPage:50,formatters:i(),criteria:{}};if(o=t.extend({},a,o),!o.scope)return console.log("Missing scope");if(!o.baseStateName)return console.log("Missing base state name");if(!o.repository)return console.log("Missing repository");var f=o.scope,u=o.repository,c=r(o.scheme||{}),l=new n(u.find).setItemsPerPage(o.itemsPerPage||s).setCriteria(o.criteria);l.first(),f.baseStateName=o.baseStateName,f.scheme=c,f.paginator=l,c.delete&&(f.delete=function(t){e.confirm("Вы уверены, что хотите удалить «"+t.title+"»?")&&u.delete(t.id).then(function(){l.first()}).catch(function(){alert("Не удалось удалить запись")})}),f.renderValue=function(e,t){var n=o.formatters[t.type]||o.formatters.default;return n(e,t)}}}])}(window,angular,window.moment);