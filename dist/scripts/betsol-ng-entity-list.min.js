/**
 * betsol-ng-entity-list - Automatic entity lists for Angular.js
 * @version v0.0.0
 * @link https://github.com/betsol/ng-entity-list
 * @license MIT
 *
 * @author Slava Fomin II <s.fomin@betsol.ru>
 */
!function(e,t,n){"use strict";function o(e){return e=t.extend({},i,e),t.forEach(e.fields,function(n,o){e.fields[o]=t.extend({},s,n)}),e}function r(){var e={};return e.default=function(e){return e},e.date=function(e,t){return n&&n.isMoment(e)?e.format(t.format||"D.M.YY HH:mm:ss"):e instanceof Date?e.toString():void 0},e}var i={title:"",fields:{},add:!0,edit:!0,"delete":!0},s={title:"",type:"string"},a=50;t.module("betsol.entityList",["ui.router","betsol.paginator"]).factory("EntityList",["Paginator",function(n){return function(i){var s={scope:null,baseStateName:"",repository:null,scheme:null,itemsPerPage:50,formatters:r()};if(i=t.extend({},s,i),console.log(i),!i.scope)return console.log("Missing scope");if(!i.baseStateName)return console.log("Missing base state name");if(!i.repository)return console.log("Missing repository");var l=i.scope,u=i.repository,f=o(i.scheme||{}),c=new n(u.find).setItemsPerPage(i.itemsPerPage||a);c.first(),l.baseStateName=i.baseStateName,l.scheme=f,l.paginator=c,f.delete&&(l.delete=function(t){e.confirm("Вы уверены, что хотите удалить «"+t.title+"»?")&&u.delete(t.id).then(function(){c.first()}).catch(function(){alert("Не удалось удалить запись")})}),l.renderValue=function(e,t){console.log("Rendering value",[e,t]);var n=i.formatters[t.type]||i.formatters.default;return n(e,t)}}}])}(window,angular,window.moment);